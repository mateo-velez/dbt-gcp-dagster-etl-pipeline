name: orch_on_push

on:
    push:
      branches:
          - main
      paths:
          - orch/*

env:
  PROJECT_NAME: ${{ vars.PROJECT_NAME }} 
  PROJECT_ID: ${{ vars.PROJECT_ID }} 
  REGION_ID: ${{ vars.REGION_ID }} 
  ENV_NAME: ${{ vars.ENV_NAME }} 

jobs:
    build:
        runs-on: ubuntu-latest

        steps:
          - name: Checkout code
            uses: actions/checkout@v2

          - name: Build imager - target test
            run: |
              cd orch/
              docker build --target test -t image:test .
            
          - name: Run test
            run: |
              docker run image:test